<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Chicago Crime Overview – Summary Dashboard</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    /* [STYLE UNCHANGED – your final styling block remains intact] */
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #ffffff;
      padding: 40px;
      color: #b54833;
    }

    .header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }

    h1 {
      font-size: 28px;
      margin: 0;
      color: #b54833;
    }

    .dashboard-btn {
      background-color: #b54833;
      color: white;
      text-decoration: none;
      font-size: 14px;
      font-weight: 600;
      padding: 10px 16px;
      border-radius: 6px;
      transition: background-color 0.2s ease;
    }

    .dashboard-btn:hover {
      background-color: #a33f2b;
    }

    .dashboard-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 40px;
    }

    .chart-card {
      flex: 1 1 300px;
      background: #ffffff;
      border: 1px solid #f7c9a6;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.02);
      text-align: center;
    }

    .chart-card h3 {
      font-size: 16px;
      font-weight: 600;
      color: #bc6a59;
      margin-bottom: 10px;
      text-align: left;
      border-bottom: 2px solid #f7b98a;
      padding-bottom: 6px;
    }

    .summary-split-box {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      flex: 1 1 240px;
      gap: 20px;
    }

    .summary-box {
      background: #ffffff;
      border: 1px solid #f7c9a6;
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      flex: 1;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.02);
    }

    .stat-number {
      font-size: 28px;
      font-weight: bold;
      color: #b54833;
    }

    .stat-label {
      font-size: 14px;
      color: #a1563f;
      margin-top: 4px;
    }

    .stat-date {
      font-size: 12px;
      color: #bb715f;
    }

    .chart-section {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 40px;
    }

    .chart-box {
      flex: 1 1 500px;
      background: #ffffff;
      border: 1px solid #f7c9a6;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
    }

    .chart-box h3 {
      text-align: left;
      font-size: 16px;
      font-weight: 600;
      color: #b54833;
      margin-bottom: 10px;
      border-bottom: 2px solid #f7b98a;
      padding-bottom: 6px;
    }

    .styled-highlight {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      border-left: 4px solid #f7b98a;
      padding: 24px;
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
      border: 1px solid #f7c9a6;
    }

    .stat-header {
      font-size: 14px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: #a1563f;
    }

    .stat-highlight-number {
      font-size: 36px;
      font-weight: 800;
      color: #b54833;
      line-height: 1;
    }

    .stat-subtext {
      font-size: 12px;
      color: #bb715f;
    }

    svg {
      display: block;
      width: 100%;
      height: 300px;
      background-color: transparent;
    }
  </style>
</head>
<body>

  <div class="header-row">
    <h1>Chicago Crime & Socio-Economic Summary</h1>
    <a class="dashboard-btn" href="dashboard.html">→ Go To Dashboard</a>
  </div>

  <div class="dashboard-grid">
    <div class="chart-card">
      <h3>Visualization 1</h3>
      <svg id="donut-guest"></svg>
    </div>
    <div class="chart-card">
      <h3>Visualization 2</h3>
      <svg id="donut-status"></svg>
    </div>
    <div class="chart-card">
      <h3>Visualization 3</h3>
      <svg id="donut-season"></svg>
    </div>
    <div class="summary-split-box">
      <div class="summary-box styled-highlight" id="total-crimes-box">
        <div class="stat-header">Total Reported Crimes</div>
        <div class="stat-highlight-number" id="total-crimes-value">–</div>
        <div class="stat-subtext">Jan 2015 – Dec 2024</div>
      </div>      
      <div class="summary-box styled-highlight" id="top-crime-box">
        <div class="stat-header" id="top-crime-name">–</div>
        <div class="stat-highlight-number" id="top-crime-count">–</div>
        <div class="stat-subtext" id="top-crime-percent">–</div>
      </div>         
    </div>
  </div> 

  <div class="chart-section">
    <div class="chart-box">
      <h3>Crime by Year</h3>
      <svg id="bar-year"></svg>
    </div>
    <div class="chart-box">
      <h3>Crime Rate Over Time</h3>
      <svg id="line-rate"></svg>
    </div>
  </div>

  <!-- === SCRIPT WITH REAL DATA INTEGRATION === -->
  <script>
    Promise.all([
      d3.csv("data/crime_rate_by_crime_group.csv", d3.autoType),
      d3.csv("data/crime_rate_by_crime_type.csv", d3.autoType)
    ]).then(([crimeGroup, crimeType]) => {
      // Total crimes
      const totalCrimes = d3.sum(crimeGroup, d => d.Crime_Count);
      d3.select("#total-crimes-value").text(totalCrimes.toLocaleString());

      // Most frequent crime type
      const typeTotals = d3.rollups(
        crimeType,
        v => d3.sum(v, d => d.Crime_Count),
        d => d.Crime_Type
      ).sort((a, b) => d3.descending(a[1], b[1]));

      const [topType, topCount] = typeTotals[0];
      const totalType = d3.sum(typeTotals, d => d[1]);
      const topPct = ((topCount / totalType) * 100).toFixed(1);

      d3.select("#top-crime-name").text(topType);
      d3.select("#top-crime-count").text(topCount.toLocaleString());
      d3.select("#top-crime-percent").text(`${topPct}% of all reports`);

      // Donut Chart – Top 5 Crime Types
      const donutData = typeTotals.slice(0, 5);
      const donutSvg = d3.select("#donut-guest"),
            width = 300, height = 300, radius = Math.min(width, height) / 2;

      const donutG = donutSvg
        .attr("viewBox", `0 0 ${width} ${height}`)
        .append("g")
        .attr("transform", `translate(${width / 2},${height / 2})`);

      const color = d3.scaleOrdinal(d3.schemeSet2);

      const pie = d3.pie().value(d => d[1]);
      const arc = d3.arc().innerRadius(60).outerRadius(radius - 10);

      donutG.selectAll("path")
        .data(pie(donutData))
        .join("path")
        .attr("d", arc)
        .attr("fill", d => color(d.data[0]))
        .append("title")
        .text(d => `${d.data[0]}: ${d.data[1].toLocaleString()}`);

      // Horizontal Bar – Crime Categories
      const barGroup = d3.group(crimeGroup, d => d.Crime_Group);
      const barData = Array.from(barGroup, ([key, values]) => ({
        name: key,
        count: d3.sum(values, d => d.Crime_Count)
      })).sort((a, b) => d3.descending(a.count, b.count));

      const barSvg = d3.select("#donut-status")
        .attr("viewBox", `0 0 300 300`);

      const x = d3.scaleLinear()
        .domain([0, d3.max(barData, d => d.count)])
        .range([0, 280]);

      const y = d3.scaleBand()
        .domain(barData.map(d => d.name))
        .range([0, 280])
        .padding(0.2);

      barSvg.selectAll("rect")
        .data(barData)
        .join("rect")
        .attr("x", 10)
        .attr("y", d => y(d.name))
        .attr("width", d => x(d.count))
        .attr("height", y.bandwidth())
        .attr("fill", "#f28e2c");

      barSvg.selectAll("text")
        .data(barData)
        .join("text")
        .attr("x", d => x(d.count) + 14)
        .attr("y", d => y(d.name) + y.bandwidth() / 2)
        .attr("dy", "0.35em")
        .text(d => d.name);

      // Horizontal Bar – Top 10 Crime Areas
      d3.csv("data/top_features_per_CA_sorted.csv", d3.autoType).then(areaData => {
        const topAreas = areaData
          .slice(0, 10)
          .map(d => ({ name: d.Community_Area, count: d.Crime_Count }));

        const areaSvg = d3.select("#donut-season")
          .attr("viewBox", `0 0 300 300`);

        const xArea = d3.scaleLinear()
          .domain([0, d3.max(topAreas, d => d.count)])
          .range([0, 280]);

        const yArea = d3.scaleBand()
          .domain(topAreas.map(d => d.name))
          .range([0, 280])
          .padding(0.2);

        areaSvg.selectAll("rect")
          .data(topAreas)
          .join("rect")
          .attr("x", 10)
          .attr("y", d => yArea(d.name))
          .attr("width", d => xArea(d.count))
          .attr("height", yArea.bandwidth())
          .attr("fill", "#e15759");

        areaSvg.selectAll("text")
          .data(topAreas)
          .join("text")
          .attr("x", d => xArea(d.count) + 14)
          .attr("y", d => yArea(d.name) + yArea.bandwidth() / 2)
          .attr("dy", "0.35em")
          .text(d => d.name);
      });

      // Vertical Bar – Crime by Year
      const yearSvg = d3.select("#bar-year")
        .attr("viewBox", `0 0 500 300`);

      const yearGroup = d3.group(crimeType, d => d.Year);
      const yearData = Array.from(yearGroup, ([year, values]) => ({
        year,
        count: d3.sum(values, d => d.Crime_Count)
      })).sort((a, b) => a.year - b.year);

      const xYear = d3.scaleBand()
        .domain(yearData.map(d => d.year))
        .range([40, 480])
        .padding(0.1);

      const yYear = d3.scaleLinear()
        .domain([0, d3.max(yearData, d => d.count)])
        .range([260, 10]);

      yearSvg.selectAll("rect")
        .data(yearData)
        .join("rect")
        .attr("x", d => xYear(d.year))
        .attr("y", d => yYear(d.count))
        .attr("width", xYear.bandwidth())
        .attr("height", d => 260 - yYear(d.count))
        .attr("fill", "#59a14f");

      yearSvg.selectAll("text")
        .data(yearData)
        .join("text")
        .attr("x", d => xYear(d.year) + xYear.bandwidth() / 2)
        .attr("y", 275)
        .attr("text-anchor", "middle")
        .attr("font-size", 10)
        .text(d => d.year);

      // Line Chart – Crime Rate Over Time
      const lineSvg = d3.select("#line-rate")
        .attr("viewBox", `0 0 500 300`);

      const timeGroup = d3.group(crimeGroup, d => `${d.Year}-${String(d.Month).padStart(2, "0")}`);
      const lineData = Array.from(timeGroup, ([key, values]) => ({
        date: d3.timeParse("%Y-%m")(key),
        count: d3.sum(values, d => d.Crime_Count)
      })).sort((a, b) => d3.ascending(a.date, b.date));

      const xLine = d3.scaleTime()
        .domain(d3.extent(lineData, d => d.date))
        .range([40, 480]);

      const yLine = d3.scaleLinear()
        .domain([0, d3.max(lineData, d => d.count)])
        .range([260, 10]);

      const line = d3.line()
        .x(d => xLine(d.date))
        .y(d => yLine(d.count))
        .curve(d3.curveMonotoneX);

      lineSvg.append("path")
        .datum(lineData)
        .attr("fill", "none")
        .attr("stroke", "#4e79a7")
        .attr("stroke-width", 2)
        .attr("d", line);

      lineSvg.selectAll("circle")
        .data(lineData)
        .join("circle")
        .attr("cx", d => xLine(d.date))
        .attr("cy", d => yLine(d.count))
        .attr("r", 2)
        .attr("fill", "#4e79a7");
    });
  </script>
</body>
</html>
